default: &base
  dispatchers:
    - polling_interval: 0.5
      batch_size: 100

  workers:
    # Character sync queues - handles API calls to Blizzard
    - queues: [character_sync_a, character_sync_b, character_sync_c, character_sync_d]
      threads: <%= ENV.fetch("CHARACTER_SYNC_THREADS", 2) %>
      processes: 1
      polling_interval: 0.25

    # PVP sync queues - fetches leaderboard data
    - queues: [pvp_sync_2v2, pvp_sync_3v3, pvp_sync_rbg, pvp_sync_shuffle]
      threads: <%= ENV.fetch("PVP_SYNC_THREADS", 2) %>
      processes: 1
      polling_interval: 0.5

    # Processing queue - CPU-intensive data processing
    - queues: [pvp_processing]
      threads: <%= ENV.fetch("PVP_PROCESSING_THREADS", 2) %>
      processes: 1
      polling_interval: 0.25

    # Default queue - misc jobs
    - queues: "*"
      threads: <%= ENV.fetch("DEFAULT_THREADS", 2) %>
      processes: 1
      polling_interval: 0.5

development:
  <<: *base

production:
  <<: *base

# Low-resource profile for cheap cloud instances (2 vCPU, 2GB RAM)
# Use with: QUEUE_PROFILE=low_resource
low_resource:
  dispatchers:
    - polling_interval: 1.0
      batch_size: 50

  workers:
    - queues: [character_sync_a, character_sync_b, character_sync_c, character_sync_d]
      threads: 1
      processes: 1
      polling_interval: 0.5

    - queues: [pvp_sync_2v2, pvp_sync_3v3, pvp_sync_rbg, pvp_sync_shuffle]
      threads: 1
      processes: 1
      polling_interval: 1.0

    - queues: [pvp_processing]
      threads: 1
      processes: 1
      polling_interval: 0.5

    - queues: "*"
      threads: 1
      processes: 1
      polling_interval: 1.0

